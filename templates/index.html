<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°Ã§erik DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼ Bot</title>
    <!-- Tailwind CSS'i yÃ¼kle (GÃ¶rsel iyileÅŸtirme iÃ§in) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
            color: #1f2937;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }
        .form-box, .output-box {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid #e5e7eb;
        }
        textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            margin-top: 6px;
            margin-bottom: 16px;
            resize: vertical;
            transition: border-color 0.2s;
        }
        textarea:focus, select:focus {
            border-color: #3b82f6;
            outline: none;
        }
        .result {
            min-height: 100px;
            padding: 12px;
            background-color: #f3f4f6;
            border-radius: 8px;
            white-space: pre-wrap;
        }
        .error {
            color: #ef4444;
            font-weight: 600;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: #10b981;
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s, transform 0.5s;
            transform: translateY(-20px);
        }
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        /* Gizleme sÄ±nÄ±fÄ± */
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl font-bold text-center mb-2">ğŸ§  AkÄ±llÄ± Metin DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼</h1>
        <p class="text-center text-gray-500 mb-8">MesajÄ±nÄ±zÄ± yazÄ±n, hedef ton ve biÃ§imi seÃ§in â€” bot sizin yerinize yeniden yazsÄ±n</p>

        <div class="form-box">
            <label class="block text-sm font-medium text-gray-700 mb-2" for="original-text">âœï¸ Orijinal Metin:</label>
            <textarea 
                id="original-text" 
                rows="5" 
                placeholder="DÃ¶nÃ¼ÅŸtÃ¼rmek istediÄŸiniz metni buraya yazÄ±n..."
                onkeyup="debounceCheckAndClassify()"
            ></textarea>
            
            <!-- Argo UyarÄ± Kutusu -->
            <div id="argo-warning" class="text-sm p-2 rounded-lg bg-red-100 text-red-700 hidden mb-4 font-semibold">
                âš ï¸ **Ä°Ã§erik UyarÄ±sÄ±:** GirdiÄŸiniz metin kaba veya uygunsuz kelimeler iÃ§eriyor. DÃ¶nÃ¼ÅŸÃ¼m sÄ±rasÄ±nda AI etik kurallarÄ± tarafÄ±ndan reddedilebilir.
            </div>

            <div id="classification-status" class="text-sm font-medium text-gray-600 mb-4">
                ğŸ” **Otomatik Ton Tespiti:** Metninizi yazÄ±n, bot tonu otomatik algÄ±lasÄ±n...
            </div>

            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700" for="tone-select">ğŸ¯ Hedef Ton / KullanÄ±m AlanÄ±:</label>
                    <select id="tone-select" class="mt-1">
                        <!-- YENÄ° ULTRA SAMÄ°MÄ° TON EKLENDÄ° -->
                        <option value="kanka">ğŸ—£ï¸ Kanka Dili / En Samimi (Argo Ä°zinli)</option>
                        <option value="resmi">ğŸ“„ ResmÃ® Kurum / DilekÃ§e Dili</option>
                        <option value="is">ğŸ’¼ Ä°ÅŸ / Ä°nsan KaynaklarÄ± (Profesyonel)</option>
                        <option value="samimi">ğŸ’¬ ArkadaÅŸÃ§a / GÃ¼nlÃ¼k Mesaj</option>
                        <option value="akademik">ğŸ“ Akademik / Bilimsel Ãœslup</option>
                        <option value="etik">âš–ï¸ Etik / SaygÄ±lÄ± ve NÃ¶tr Dil</option>
                        <option value="ozur">ğŸ™ Ã–zÃ¼r Dileyici / Kibar Ãœslup</option>
                        <option value="destek">ğŸ› ï¸ Destek Talebi / YardÄ±m Ä°steÄŸi</option>
                        <option value="tanitim">ğŸ“¢ TanÄ±tÄ±m / Reklam MesajÄ±</option>
                        <option value="mail">âœ‰ï¸ E-Posta YazÄ±ÅŸmasÄ± (YarÄ± ResmÃ®)</option>
                        <option value="rapor">ğŸ“Š Rapor / Ä°ÅŸ Sunumu Ãœslubu</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700" for="font-select">ğŸ”  YazÄ± Tipi (YalnÄ±zca BiÃ§imsel Not):</label>
                    <select id="font-select" class="mt-1">
                        <option value="Arial, sans-serif">Arial (Dengeli ve Kurumsal)</option>
                        <option value="'Times New Roman', serif">Times New Roman (Klasik ve Ciddi)</option>
                        <option value="Verdana, sans-serif">Verdana (OkunaklÄ± ve Modern)</option>
                        <option value="Calibri, sans-serif">Calibri (Profesyonel ve Hafif)</option>
                        <option value="'Courier New', monospace">Courier New (Teknik / Kod TarzÄ±)</option>
                    </select>
                </div>
            </div>

            <button 
                onclick="rewriteText()" 
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl mt-4 transition duration-300 transform hover:scale-[1.01] shadow-lg"
            >
                âœ¨ Metni DÃ¶nÃ¼ÅŸtÃ¼r ve BiÃ§imlendir
            </button>
        </div>

        <div class="output-box">
            <div id="loading" class="hidden text-center p-4 text-blue-600 font-semibold">
                ğŸ”„ MesajÄ±nÄ±z LLM tarafÄ±ndan dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼yor, lÃ¼tfen bekleyin...
            </div>
            
            <!-- Ton Ã‡akÄ±ÅŸmasÄ± UyarÄ±sÄ± AlanÄ± -->
            <div id="conflict-warning" class="hidden p-3 rounded-lg bg-yellow-100 text-yellow-800 mb-4 text-sm">
                <!-- UyarÄ± mesajÄ± buraya gelecek -->
            </div>

            <h3 class="text-xl font-semibold mb-3">ğŸ“ DÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmÃ¼ÅŸ Mesaj:</h3>
            <div id="result-text" class="result text-gray-700">
                DÃ¶nÃ¼ÅŸtÃ¼rÃ¼len metin burada, seÃ§tiÄŸiniz yazÄ± tipinde gÃ¶rÃ¼necektir.
            </div>
            
            <!-- NLP Metrikleri AlanÄ± -->
            <div id="metrics-output" class="mt-6 border-t pt-4 hidden">
                <h4 class="text-lg font-semibold mb-2 text-gray-700">ğŸ“Š NLP Metrik Analizi:</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div class="p-3 bg-indigo-50 rounded-lg">
                        <span class="font-bold text-indigo-700">Anlam Korunma (Kos. BenzerliÄŸi):</span>
                        <p id="similarity-score" class="text-lg mt-1 font-mono">--</p>
                    </div>
                    <div class="p-3 bg-green-50 rounded-lg">
                        <span class="font-bold text-green-700">Okunabilirlik (Orijinal):</span>
                        <p id="readability-original" class="text-lg mt-1 font-mono">--</p>
                    </div>
                    <div class="p-3 bg-red-50 rounded-lg">
                        <span class="font-bold text-red-700">Okunabilirlik (DÃ¶nÃ¼ÅŸtÃ¼rÃ¼lmÃ¼ÅŸ):</span>
                        <p id="readability-rewritten" class="text-lg mt-1 font-mono">--</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ã–zel UyarÄ± Kutusu -->
    <div id="notification" class="notification"></div>

    <script>
        // ALERT YERÄ°NE KULLANILAN Ã–ZEL BÄ°LDÄ°RÄ°M FONKSÄ°YONU
        function showNotification(message, isError = false) {
            const notificationDiv = document.getElementById('notification');
            notificationDiv.textContent = message;
            notificationDiv.style.backgroundColor = isError ? '#ef4444' : '#10b981';
            
            notificationDiv.classList.add('show');
            setTimeout(() => {
                notificationDiv.classList.remove('show');
            }, 3000);
        }

        // DEBOUNCE (Gecikmeli Ã‡aÄŸrÄ±) Ä°Ã‡Ä°N GEREKLÄ° DEÄÄ°ÅKEN
        let classificationTimeout = null;
        
        // TÃ¼rkÃ§e Argo Kelimelerin Basit Listesi (Client-side kontrol iÃ§in)
        const ARGO_WORDS = [
            'salak', 'aptal', 'gerizekalÄ±', 'lan', 'ulan', 'yavÅŸak', 'sik', 'siktir',
            'amk', 'orosbu', 'piÃ§', 'hÄ±rsÄ±z', 'terÃ¶rist', 'kÃ¼fÃ¼r', 'saÃ§ma'
            // Bu liste, projenin etik sÄ±nÄ±rlarÄ±na gÃ¶re geniÅŸletilebilir.
        ];

        // Argo Kelime KontrolÃ¼
        function checkForArgo(text) {
            const lowerText = text.toLowerCase();
            const argoWarningDiv = document.getElementById('argo-warning');
            let argoDetected = false;

            for (const word of ARGO_WORDS) {
                // Kelime sÄ±nÄ±rlarÄ± iÃ§inde kontrol et
                const regex = new RegExp(`\\b${word}\\b`, 'g');
                if (regex.test(lowerText)) {
                    argoDetected = true;
                    break;
                }
            }

            if (argoDetected) {
                argoWarningDiv.classList.remove('hidden');
            } else {
                argoWarningDiv.classList.add('hidden');
            }
        }

        // OTOMATÄ°K SÄ±nÄ±flandÄ±rma Fonksiyonu
        function classifyText() {
            const originalText = document.getElementById('original-text').value.trim();
            const statusDiv = document.getElementById('classification-status');

            if (originalText.length < 15) {
                statusDiv.innerHTML = 'ğŸ” **Otomatik Ton Tespiti:** Metin algÄ±lanacak kadar uzun deÄŸil.';
                return;
            }

            statusDiv.innerHTML = 'ğŸ” **Ton Tespiti:** Analiz ediliyor...';

            // DÄ°KKAT: Argo/Kanka tonu, sÄ±nÄ±flandÄ±rma modeline dahil edilmediÄŸi iÃ§in, 
            // sÄ±nÄ±flandÄ±rma sÄ±rasÄ±nda bu ton otomatik olarak seÃ§ilmeyecektir.
            // SÄ±nÄ±flandÄ±rma, sadece orijinal 10 tonu kullanÄ±r.

            fetch('/classify', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: originalText })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const scorePercentage = (data.score * 100).toFixed(1);
                    // Sunucudan gelen 'label' deÄŸiÅŸkenini kullandÄ±k
                    statusDiv.innerHTML = `âœ… **AlgÄ±lanan Ton:** <span class="text-green-600 font-bold">${data.label.toUpperCase()}</span> (${scorePercentage}% gÃ¼ven)`;
                    
                    // AlgÄ±lanan tonu otomatik olarak seÃ§ili hale getir (Sadece orijinal 10 ton iÃ§in)
                    const select = document.getElementById('tone-select');
                    const options = Array.from(select.options);
                    // Kanka tonu haricindeki eÅŸleÅŸmeyi bul
                    const matchingOption = options.find(opt => opt.value === data.label && opt.value !== 'kanka');

                    if (matchingOption) {
                        // EÄŸer metin zaten samimiye yakÄ±nsa, samimi tonu seÃ§sin
                        if (data.label === 'samimi' || data.label === 'ozur' || data.label === 'destek') {
                            select.value = 'samimi';
                        } else {
                            select.value = data.label;
                        }
                    }
                } else {
                    statusDiv.innerHTML = `âš ï¸ **Ton Tespiti HatasÄ±:** ${data.error}`;
                }
            })
            .catch(err => {
                console.error("SÄ±nÄ±flandÄ±rma sunucu hatasÄ±:", err);
                statusDiv.innerHTML = 'âŒ **BaÄŸlantÄ± HatasÄ±:** SÄ±nÄ±flandÄ±rma servisine ulaÅŸÄ±lamadÄ±.';
            });
        }
        
        // Gecikmeli sÄ±nÄ±flandÄ±rmayÄ± ve Argo kontrolÃ¼nÃ¼ baÅŸlatan fonksiyon
        function debounceCheckAndClassify() {
            const originalText = document.getElementById('original-text').value.trim();
            
            // Argo kontrolÃ¼nÃ¼ hemen yap
            checkForArgo(originalText);

            // SÄ±nÄ±flandÄ±rmayÄ± gecikmeli baÅŸlat
            clearTimeout(classificationTimeout);
            classificationTimeout = setTimeout(classifyText, 800); // 800ms sonra sÄ±nÄ±flandÄ±r
        }


        // ANA Yeniden Yazma Fonksiyonu
        function rewriteText() {
            const originalText = document.getElementById('original-text').value.trim();
            const tone = document.getElementById('tone-select').value;
            const font = document.getElementById('font-select').value;
            const resultDiv = document.getElementById('result-text');
            const loadingDiv = document.getElementById('loading');
            const metricsDiv = document.getElementById('metrics-output');
            const conflictWarningDiv = document.getElementById('conflict-warning');

            // Hata ve UyarÄ±larÄ± Temizle
            conflictWarningDiv.classList.add('hidden');
            conflictWarningDiv.innerHTML = '';
            metricsDiv.classList.add('hidden');


            if (!originalText) {
                showNotification("LÃ¼tfen dÃ¶nÃ¼ÅŸtÃ¼rmek istediÄŸiniz bir metin girin.", true);
                return;
            }

            // EÄŸer hedef ton 'kanka' ise ve metinde argo tespit edildiyse, Ã¶zel bir uyarÄ± gÃ¶sterilebilir
            const argoWarningIsVisible = !document.getElementById('argo-warning').classList.contains('hidden');
            if (tone === 'kanka' && argoWarningIsVisible) {
                conflictWarningDiv.innerHTML = "ğŸ’¡ **Ek Bilgi:** 'Kanka Dili'ni seÃ§tiÄŸiniz iÃ§in, girdiÄŸiniz argo kelimeler dÃ¶nÃ¼ÅŸtÃ¼rÃ¼len metinde **daha doÄŸal bir ÅŸekilde** korunmaya Ã§alÄ±ÅŸÄ±lacaktÄ±r. DÃ¶nÃ¼ÅŸÃ¼m baÅŸarÄ±lÄ± olabilir.";
                conflictWarningDiv.classList.remove('hidden');
            }


            loadingDiv.classList.remove('hidden');
            resultDiv.innerHTML = 'DÃ¶nÃ¼ÅŸtÃ¼rme iÅŸlemi sÃ¼rÃ¼yor...';

            fetch('/rewrite', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: originalText, tone: tone, font: font })
            })
            .then(response => response.json())
            .then(data => {
                loadingDiv.classList.add('hidden');
                
                // Ton Ã‡akÄ±ÅŸmasÄ± UyarÄ±sÄ± (Genel)
                if (data.warning) {
                    // Kanka tonu seÃ§ildiÄŸinde, Ã§akÄ±ÅŸma uyarÄ±sÄ±nÄ± ezme
                    if (tone !== 'kanka') {
                        conflictWarningDiv.innerHTML = data.warning;
                        conflictWarningDiv.classList.remove('hidden');
                    }
                }

                if (data.success) {
                    const rewritten = data.rewritten.replace(/\n/g, '<br>');
                    
                    // Metin sonuÃ§ kutusunun fontunu seÃ§ime gÃ¶re ayarla
                    resultDiv.innerHTML = `<p style="font-family:${font}; line-height: 1.6;">${rewritten}</p>`;
                    showNotification("Metin baÅŸarÄ±yla dÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼!");

                    // Metrikleri GÃ¶ster
                    document.getElementById('similarity-score').textContent = data.metrics.similarity.toFixed(4);
                    document.getElementById('readability-original').textContent = data.metrics.readability_original;
                    document.getElementById('readability-rewritten').textContent = data.metrics.readability_rewritten;
                    metricsDiv.classList.remove('hidden');

                } else {
                    // API/GÃ¼venlik HatasÄ±
                    resultDiv.innerHTML = `<p class="error">Hata: ${data.error}</p>`;
                    showNotification(`DÃ¶nÃ¼ÅŸtÃ¼rme baÅŸarÄ±sÄ±z oldu: ${data.error.substring(0, 50)}...`, true);
                }
            })
            .catch(err => {
                loadingDiv.classList.add('hidden');
                resultDiv.innerHTML = `<p class="error">Sunucuya baÄŸlanÄ±lamadÄ±. AÄŸÄ±nÄ±zÄ± veya Flask uygulamasÄ±nÄ± kontrol edin.</p>`;
                showNotification("Kritik sunucu hatasÄ±!", true);
            });
        }
    </script>
</body>
</html>
